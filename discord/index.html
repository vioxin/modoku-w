<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Discord ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡</title>
    <style>
        body { font-family: sans-serif; background: #2c2f33; color: white; padding: 20px; }
        #chat-box { background: #23272a; padding: 15px; height: 300px; overflow-y: scroll; border-radius: 8px; margin-bottom: 15px;}
        .message { margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .author { font-weight: bold; color: #7289da; }
        input[type="text"] { width: 70%; padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #7289da; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #5b6eae; }
    </style>
</head>
<body>

    <h2>ğŸŒ Discord â‡” Web ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ</h2>
    
    <div id="chat-box">èª­ã¿è¾¼ã¿ä¸­...</div>

    <div>
        <input type="text" id="msg-input" placeholder="Discordã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡...">
        <button onclick="sendMessage()">é€ä¿¡ã™ã‚‹</button>
    </div>

    <script>
        // âš ï¸ è¶…é‡è¦ï¼šã“ã“ã«ã‚ãªãŸã®Renderã®URLã‚’è²¼ã£ã¦ãã ã•ã„ï¼
        // ä¾‹: "https://my-discord-bot.onrender.com" (æœ€å¾Œã® / ã¯ä¸è¦ã§ã™)
        const SERVER_URL = "https://kankun-app.onrender.com/";

        // 1. Discordã®ä¼šè©±å±¥æ­´ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
        async function fetchMessages() {
            try {
                const response = await fetch(`${SERVER_URL}/api/messages`);
                const messages = await response.json();
                
                const chatBox = document.getElementById('chat-box');
                chatBox.innerHTML = ''; // ä¸€åº¦ç©ºã«ã™ã‚‹
                
                messages.forEach(msg => {
                    chatBox.innerHTML += `
                        <div class="message">
                            <span class="author">${msg.author}:</span> 
                            <span>${msg.content}</span>
                        </div>
                    `;
                });
                
                // ä¸€ç•ªä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                console.error("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
            }
        }

        // 2. Webã‚µã‚¤ãƒˆã‹ã‚‰Discordã¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹é–¢æ•°
        async function sendMessage() {
            const input = document.getElementById('msg-input');
            const text = input.value;
            if (!text) return;

            try {
                await fetch(`${SERVER_URL}/api/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });
                input.value = ''; // é€ä¿¡ã—ãŸã‚‰å…¥åŠ›æ¬„ã‚’ç©ºã«ã™ã‚‹
                fetchMessages(); // ã™ãã«å±¥æ­´ã‚’æ›´æ–°
            } catch (error) {
                alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼ã‚µãƒ¼ãƒãƒ¼ã®URLãŒåˆã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
            }
        }

        // 3. å®šæœŸçš„ã«ï¼ˆ2ç§’ã”ã¨ã«ï¼‰Discordã®æ–°ã—ã„ä¼šè©±ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
        setInterval(fetchMessages, 2000);
        // æœ€åˆã®1å›ç›®ã‚’å³åº§ã«å®Ÿè¡Œ
        fetchMessages();
    </script>
</body>
</html>
