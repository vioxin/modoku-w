<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Discord ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡</title>
    <style>
        body { font-family: sans-serif; background: #2c2f33; color: white; padding: 20px; }
        #chat-box { background: #23272a; padding: 15px; height: 300px; overflow-y: auto; border-radius: 8px; margin-bottom: 15px;}
        .message { margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .author { font-weight: bold; color: #7289da; }
        /* å…¥åŠ›æ¬„ã¨ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .controls { margin-bottom: 15px; display: flex; gap: 10px; }
        input[type="text"] { flex-grow: 1; padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 15px; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* é€ä¿¡ãƒœã‚¿ãƒ³ï¼ˆé’è‰²ï¼‰ */
        .send-btn { background: #7289da; }
        .send-btn:hover { background: #5b6eae; }
        
        /* ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ï¼ˆç·‘è‰²ï¼‰ */
        .reload-btn { background: #43b581; } 
        .reload-btn:hover { background: #3ca374; }
        
        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„æ™‚ã®è–„ã„æ–‡å­— */
        .empty-msg { color: #99aab5; font-style: italic; text-align: center; padding-top: 50px; }
    </style>
</head>
<body>

    <h2>ğŸŒ Discord â‡” Web ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ</h2>
    
    <div class="controls">
        <button class="reload-btn" onclick="fetchMessages()">ğŸ”„ æœ€æ–°ã®å±¥æ­´ã‚’æ‰‹å‹•ã§èª­ã¿è¾¼ã‚€</button>
    </div>

    <div id="chat-box">é€šä¿¡ä¸­...</div>

    <div class="controls">
        <input type="text" id="msg-input" placeholder="Discordã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡...">
        <button class="send-btn" onclick="sendMessage()">é€ä¿¡ã™ã‚‹</button>
    </div>

    <script>
        // âš ï¸ ã“ã“ã¯ã‚ãªãŸã®Renderã®URLã‚’å…¥ã‚Œã¦ãã ã•ã„ï¼ï¼ˆæœ«å°¾ã® / ã¯ä¸è¦ã§ã™ï¼‰
        const SERVER_URL = "https://ã“ã“ã«_ã‚ãªãŸã®_RENDERã®_URL_ã‚’å…¥ã‚Œã‚‹";

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        async function fetchMessages() {
            try {
                const response = await fetch(`${SERVER_URL}/api/messages`);
                const messages = await response.json();
                
                const chatBox = document.getElementById('chat-box');
                chatBox.innerHTML = ''; 
                
                // ğŸ’¡ è¿½åŠ ï¼šå±¥æ­´ãŒç©ºã£ã½ã®æ™‚ã®å‡¦ç†
                if (messages.length === 0) {
                    chatBox.innerHTML = '<div class="empty-msg">ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>Discordã§ä½•ã‹ç™ºè¨€ã™ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼</div>';
                    return;
                }

                messages.forEach(msg => {
                    chatBox.innerHTML += `
                        <div class="message">
                            <span class="author">${msg.author}:</span> 
                            <span>${msg.content}</span>
                        </div>
                    `;
                });
                
                // ä¸€ç•ªä¸‹ã«è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                console.error("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
                document.getElementById('chat-box').innerHTML = '<div class="empty-msg" style="color: #f04747;">ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã§ãã¾ã›ã‚“ã€‚<br>RenderãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°
        async function sendMessage() {
            const input = document.getElementById('msg-input');
            const text = input.value;
            if (!text) return;

            try {
                await fetch(`${SERVER_URL}/api/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });
                input.value = ''; 
                fetchMessages(); // é€ä¿¡å¾Œã™ãã«å±¥æ­´ã‚’æ›´æ–°
            } catch (error) {
                alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼");
            }
        }

        // 2ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ãŒã‚ã£ã¦ã‚‚ã€ä¸€å¿œè‡ªå‹•æ›´æ–°ã‚‚æ®‹ã—ã¦ãŠãã¾ã™ï¼‰
        setInterval(fetchMessages, 2000);
        fetchMessages();
    </script>
</body>
</html>
