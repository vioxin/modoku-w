<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ãƒ‘ãƒãƒ« - modoku-w</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #121212; color: #e0e0e0; }
        .container { max-width: 1000px; margin: auto; background: #1e1e1e; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.6); }
        h1, h2 { color: #ffffff; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .admin-section { margin-top: 40px; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        
        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .form-group { margin-bottom: 15px; }
        input[type="text"], textarea, input[type="password"] { 
            width: 100%; padding: 10px; background: #2c2c2c; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box;
        }
        textarea { height: 100px; }
        .submit-btn { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        .submit-btn:hover { background: #2ecc71; }

        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #252525; }
        th, td { border: 1px solid #383838; padding: 12px; text-align: left; }
        th { background: #333; color: #3498db; }
        .del-btn { background: #c0392b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; }
        .refresh-btn { float: right; padding: 8px 15px; background: #2980b9; color: white; border: none; border-radius: 4px; cursor: pointer; }
        
        #loginSection { text-align: center; margin-top: 100px; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSection">
        <h1>Admin Authentication</h1>
        <input type="password" id="adminInput" placeholder="Password">
        <button onclick="adminAuth()" style="margin-top:10px; padding:10px 20px;">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <p id="loginError" style="color:red;"></p>
    </div>

    <div id="adminContent" style="display:none;">
        <button class="refresh-btn" onclick="loadAllData()">å…¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
        <h1>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

        <div class="admin-section">
            <h2>ğŸ“¢ ãŠçŸ¥ã‚‰ã›ã‚’æŠ•ç¨¿ã™ã‚‹</h2>
            <div class="form-group">
                <input type="text" id="newsTitle" placeholder="ãŠçŸ¥ã‚‰ã›ã®ã‚¿ã‚¤ãƒˆãƒ«">
            </div>
            <div class="form-group">
                <textarea id="newsContent" placeholder="ãŠçŸ¥ã‚‰ã›ã®æœ¬æ–‡ï¼ˆinformï¼‰"></textarea>
            </div>
            <button class="submit-btn" onclick="postNews()">ãŠçŸ¥ã‚‰ã›ã‚’å…¬é–‹</button>
        </div>

        <div class="admin-section">
            <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
            <table id="userTable"><thead><tr><th>ID</th><th>åå‰</th><th>æ“ä½œ</th></tr></thead><tbody id="userListBody"></tbody></table>
        </div>

        <div class="admin-section">
            <h2>æ²ç¤ºæ¿ç®¡ç†</h2>
            <table id="postTable"><thead><tr><th>æ—¥æ™‚</th><th>åå‰</th><th>æœ¬æ–‡</th><th>æ“ä½œ</th></tr></thead><tbody id="postListBody"></tbody></table>
        </div>

        <div class="admin-section">
            <h2>ãŠçŸ¥ã‚‰ã›ç®¡ç†ï¼ˆå‰Šé™¤ï¼‰</h2>
            <table id="newsTable"><thead><tr><th>æ—¥ä»˜</th><th>ã‚¿ã‚¤ãƒˆãƒ«</th><th>æ“ä½œ</th></tr></thead><tbody id="newsListBody"></tbody></table>
        </div>
    </div>
</div>

<script>
    // ã€è¨­å®šã€‘3ã¤ã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    const AUTH_GAS_URL = "https://script.google.com/macros/s/AKfycbzzdPk8BxStCsLa0iyhkHeLp3AGnbcvn5FtMrFjRSIvO2aNXQZMdvlsdC44Mrmn6MZ7/exec";
    const BBS_GAS_URL  = "https://script.google.com/macros/s/AKfycbzOpcoQtkoLBCUhmfd4RPCV6BhQs8ngf9fLiXYE8ALgDmJsr_ic4LnrSyFj5ChgwJoRhQ/exec";
    const NEWS_GAS_URL = "https://script.google.com/macros/s/AKfycbzOm_RDGEyq_kPsbER9GT4vTwZD68X39dgrZ0-udH1CyTN9sQcjW3_MgRmAd29BwLjIsQ/exec";

    let currentAdminPass = "";

    async function adminAuth() {
        const pass = document.getElementById("adminInput").value;
        const res = await fetch(AUTH_GAS_URL, { method: "POST", body: JSON.stringify({ action: "admin_login", password: pass }) });
        const result = await res.json();
        if (result.success) {
            currentAdminPass = pass;
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("adminContent").style.display = "block";
            loadAllData();
        } else { document.getElementById("loginError").innerText = "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸æ­£"; }
    }

    async function loadAllData() {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
        fetch(AUTH_GAS_URL, { method: "POST", body: JSON.stringify({ action: "admin_get_users", adminPass: currentAdminPass }) })
            .then(r => r.json()).then(d => renderTable("userListBody", d.users, u => `<td>${u.id}</td><td>${u.name}</td><td><button class="del-btn" onclick="deleteItem('${AUTH_GAS_URL}','admin_delete_user','targetId','${u.id}')">å‰Šé™¤</button></td>`));

        // æ²ç¤ºæ¿å–å¾—
        fetch(BBS_GAS_URL).then(r => r.json()).then(d => renderTable("postListBody", d, p => `<td>${p.date}</td><td>${p.name}</td><td>${p.message || p.inform}</td><td><button class="del-btn" onclick="deleteItem('${BBS_GAS_URL}','admin_delete_post','row',${p.row})">å‰Šé™¤</button></td>`));

        // ãŠçŸ¥ã‚‰ã›å–å¾—
        fetch(NEWS_GAS_URL).then(r => r.json()).then(d => renderTable("newsListBody", d, n => `<td>${n.date}</td><td>${n.tittle}</td><td><button class="del-btn" onclick="deleteItem('${NEWS_GAS_URL}','admin_delete_news','row',${n.row})">å‰Šé™¤</button></td>`));
    }

    function renderTable(id, data, htmlFunc) {
        const b = document.getElementById(id); b.innerHTML = "";
        if(data) data.forEach(item => { const r = document.createElement("tr"); r.innerHTML = htmlFunc(item); b.appendChild(r); });
    }

    // ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿æ©Ÿèƒ½
    async function postNews() {
        const title = document.getElementById("newsTitle").value;
        const inform = document.getElementById("newsContent").value;
        if(!title || !inform) return alert("å…¥åŠ›ã—ã¦ãã ã•ã„");

        const res = await fetch(NEWS_GAS_URL, {
            method: "POST",
            body: JSON.stringify({ action: "admin_add_news", title: title, inform: inform, adminPass: currentAdminPass })
        });
        if((await res.json()).success) { alert("æŠ•ç¨¿å®Œäº†"); loadAllData(); }
    }

    // æ±ç”¨å‰Šé™¤é–¢æ•°
    async function deleteItem(url, action, keyName, val) {
        if(!confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        const body = { action: action, adminPass: currentAdminPass };
        body[keyName] = val;
        const res = await fetch(url, { method: "POST", body: JSON.stringify(body) });
        if((await res.json()).success) loadAllData();
    }
</script>
</body>
</html>
