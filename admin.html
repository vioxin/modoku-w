<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER ADMIN PANEL - modoku-w</title>
    <style>
        /* ===== ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ•°å®šç¾©ï¼ˆã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ä»•æ§˜ï¼‰ ===== */
        :root {
            --main-bg: #050510;
            --text-color: #ffffff;
            --primary: #00f3ff;
            --secondary: #bc13fe;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --border-color: rgba(0, 243, 255, 0.3);
            --font-main: "Helvetica Neue", Arial, sans-serif;
        }
        body { font-family: var(--font-main); padding: 20px; background-color: var(--main-bg); color: var(--text-color); margin: 0; overflow-x: hidden; }

        /* èƒŒæ™¯Canvas & ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        #canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s ease; }
        .loader-circle { width: 50px; height: 50px; border: 3px solid transparent; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        .loader-circle:before { content: ""; position: absolute; top: 5px; left: 5px; right: 5px; bottom: 5px; border-radius: 50%; border: 3px solid transparent; border-top-color: var(--secondary); animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .container { max-width: 1200px; margin: auto; position: relative; z-index: 1; }
        h1, h2 { color: #fff; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 10px var(--primary); border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        
        /* ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ (3D Tilt & Glassmorphism) */
        .admin-section, #loginSection {
            margin-top: 40px; padding: 30px; border-radius: 15px;
            background: var(--glass-bg); border: 1px solid var(--border-color);
            backdrop-filter: blur(5px); transition: transform 0.1s, box-shadow 0.3s;
            transform-style: preserve-3d;
        }
        .tilt-effect:hover { box-shadow: 0 0 30px rgba(0, 243, 255, 0.2); border-color: var(--primary); }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; font-size: 0.9em; border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0, 243, 255, 0.1); color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
        td { background: rgba(0,0,0,0.2); }

        /* ãƒœã‚¿ãƒ³ã¨ãƒ•ã‚©ãƒ¼ãƒ  */
        input, textarea, select {
            padding: 12px; background: rgba(0, 0, 0, 0.5); border: 1px solid var(--border-color);
            color: var(--primary); border-radius: 5px; box-sizing: border-box; font-family: monospace; transition: 0.3s;
        }
        input:focus, textarea:focus, select:focus { outline: none; box-shadow: 0 0 15px var(--primary); border-color: var(--primary); }
        textarea { width: 100%; height: 100px; margin-top: 10px; }

        button { cursor: pointer; font-weight: bold; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; border-radius: 5px; border: none; padding: 10px 20px; }
        .del-btn { background: rgba(255, 0, 85, 0.2); color: #ff0055; border: 1px solid #ff0055; }
        .del-btn:hover { background: #ff0055; color: white; box-shadow: 0 0 15px #ff0055; }
        .refresh-btn, .post-btn, .generate-btn { background: linear-gradient(45deg, var(--secondary), var(--primary)); color: white; }
        .refresh-btn:hover, .post-btn:hover, .generate-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--secondary); }
        .refresh-btn { float: right; }

        #loginSection { text-align: center; margin-top: 15vh; max-width: 500px; margin-left: auto; margin-right: auto; }
        #loginSection input { width: 80%; margin-bottom: 20px; display: block; margin-left: auto; margin-right: auto; }
        .thread-select { width: 100%; margin-top: 15px; }

        /* ãƒ­ã‚°ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤º */
        .flex-row { display: flex; gap: 25px; flex-wrap: wrap; margin-top: 20px; }
        .flex-item { flex: 1; min-width: 250px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); }
        .log-viewer { background: rgba(0,0,0,0.8); color: var(--primary); padding: 15px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px; margin-top: 15px; border: 1px solid var(--border-color); border-radius: 5px; }
        .token-code { background: rgba(188, 19, 254, 0.2); padding: 5px 10px; color: var(--primary); font-family: monospace; border-radius: 5px; border: 1px solid var(--secondary); display: inline-block; }
        #newTokenDisplay { background: rgba(0, 243, 255, 0.1); padding: 20px; border-radius: 10px; border: 1px solid var(--primary); margin-bottom: 20px; }
    </style>
</head>
<body>
<canvas id="canvas-bg"></canvas>
<div id="loader"><div class="loader-circle"></div></div>

<div class="container">
    <div id="loginSection" class="tilt-effect">
        <h1>ADMIN AUTHENTICATION</h1>
        <input type="password" id="adminInput" placeholder="PASSWORD">
        <button onclick="adminAuth()" class="post-btn" style="width: 80%;">LOGIN</button>
    </div>

    <div id="adminContent" style="display:none;">
        <button class="refresh-btn" onclick="loadAllData()">ğŸ”„ RELOAD ALL DATA</button>
        <h1>ADMIN DASHBOARD</h1>

        <div class="admin-section tilt-effect">
            <h2>ğŸ« Proãƒ—ãƒ©ãƒ³ ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ</h2>
            <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                ä»˜ä¸æ—¥æ•°: <input type="number" id="tokenDays" value="30" style="width: 80px;"> æ—¥
                <button class="generate-btn" onclick="generateToken()">ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ</button>
            </div>
            <div id="newTokenDisplay" style="display:none;">
                <strong style="color:var(--primary)">ç™ºè¡Œå®Œäº†ï¼š</strong> <span id="generatedToken" class="token-code" style="font-size:1.2em;"></span>
                <br><small id="tokenInfo" style="color:#aaa;"></small>
            </div>
            <table><thead><tr><th>ãƒˆãƒ¼ã‚¯ãƒ³</th><th>æ—¥æ•°</th><th>çŠ¶æ…‹</th><th>ä½œæˆæ—¥</th></tr></thead><tbody id="tokenList"></tbody></table>
        </div>

        <div class="admin-section tilt-effect">
            <h2>ğŸ›¡ï¸ é˜²è¡›è¨­å®š & ãƒ­ã‚°</h2>
            <div class="flex-row">
                <div class="flex-item">
                    <p style="color: var(--secondary); font-weight: bold;">NGãƒ¯ãƒ¼ãƒ‰è¿½åŠ </p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="ngInput" placeholder="ç¦æ­¢ç”¨èª" style="flex:1;">
                        <button class="post-btn" style="margin:0;" onclick="updateSecurity('add_ng_word')">è¿½åŠ </button>
                    </div>
                    <div id="ngList" style="margin-top:15px; font-size:0.9em; color:var(--primary); font-family:monospace;"></div>
                </div>
                <div class="flex-item">
                    <p style="color: #ff0055; font-weight: bold;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¦æ­¢(BAN)</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="banInput" placeholder="åå‰" style="flex:1;">
                        <button class="del-btn" style="margin:0;" onclick="updateSecurity('add_banned_user')">ç¦æ­¢</button>
                    </div>
                    <div id="banList" style="margin-top:15px; font-size:0.9em; color:var(--primary); font-family:monospace;"></div>
                </div>
            </div>
            <p style="margin-top:25px; color:var(--primary);">SYSTEM LOG (LATEST 50)</p>
            <div id="logViewer" class="log-viewer">LOADING LOGS...</div>
        </div>

        <div class="admin-section tilt-effect">
            <h2>ğŸ“¢ ãŠçŸ¥ã‚‰ã›ç®¡ç†</h2>
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                <p style="margin: 0 0 15px 0; color: var(--primary); font-weight: bold;">æ–°è¦ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿</p>
                <input type="text" id="newsTitleInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" style="width: 100%; margin-bottom: 10px;">
                <textarea id="newsContentInput" placeholder="ãŠçŸ¥ã‚‰ã›ã®æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                <button class="post-btn" onclick="postNews()" style="width: 100%; margin-top: 15px;">ãŠçŸ¥ã‚‰ã›ã‚’å…¬é–‹ã™ã‚‹</button>
            </div>
            <p>æŠ•ç¨¿æ¸ˆã¿ãƒªã‚¹ãƒˆ</p>
            <table id="newsTable"><thead><tr><th>æ—¥ä»˜</th><th>ã‚¿ã‚¤ãƒˆãƒ«</th><th>æ“ä½œ</th></tr></thead><tbody id="newsListBody"></tbody></table>
        </div>

        <div class="admin-section tilt-effect">
            <h2>ğŸ§µ ã‚¹ãƒ¬ãƒƒãƒ‰æ²ç¤ºæ¿ç®¡ç†</h2>
            <p>ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§</p>
            <table id="threadTable"><thead><tr><th>ã‚¹ãƒ¬ãƒƒãƒ‰å</th><th>ä½œæˆè€…</th><th>æ“ä½œ</th></tr></thead><tbody id="threadListBody"></tbody></table>
            <p style="margin-top:30px;">ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã®æŠ•ç¨¿ã‚’ç®¡ç†</p>
            <select id="threadSelector" class="thread-select" onchange="loadThreadPosts()"><option value="">ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</option></select>
            <table id="threadPostTable"><thead><tr><th>åå‰</th><th>æœ¬æ–‡</th><th>æ“ä½œ</th></tr></thead><tbody id="threadPostListBody"></tbody></table>
        </div>

        <div class="admin-section tilt-effect"><h2>ğŸ’¬ ãƒ¡ã‚¤ãƒ³æ²ç¤ºæ¿ç®¡ç†</h2><table id="postTable"><thead><tr><th>æ—¥æ™‚</th><th>åå‰</th><th>æœ¬æ–‡</th><th>IP</th><th>ID</th><th>æ“ä½œ</th></tr></thead><tbody id="postListBody"></tbody></table></div>
        <div class="admin-section tilt-effect"><h2>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2><table id="userTable"><thead><tr><th>ID</th><th>åå‰</th><th>æ“ä½œ</th></tr></thead><tbody id="userListBody"></tbody></table></div>
        <div class="admin-section tilt-effect"><h2>ğŸ–¼ï¸ ç”»åƒæ²ç¤ºæ¿ç®¡ç†</h2><table id="galleryTable"><thead><tr><th>åå‰</th><th>æœ¬æ–‡</th><th>ç”»åƒ</th><th>æ“ä½œ</th></tr></thead><tbody id="galleryListBody"></tbody></table></div>
    </div>
</div>

<script>
    // ==========================================
    // 0. è¿½åŠ ï¼šãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨JS
    // ==========================================
    window.addEventListener('load', () => {
        const loader = document.getElementById('loader');
        loader.style.opacity = '0'; setTimeout(() => { loader.style.display = 'none'; }, 500);
    });
    const canvas = document.getElementById('canvas-bg');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let particlesArray; let mouse = { x: null, y: null, radius: (canvas.height/80)*(canvas.width/80) }
    window.addEventListener('mousemove', (event) => { mouse.x = event.x; mouse.y = event.y; });
    class Particle {
        constructor(x,y,dx,dy,size,color){this.x=x;this.y=y;this.directionX=dx;this.directionY=dy;this.size=size;this.color=color;}
        draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2,false);ctx.fillStyle='#00f3ff';ctx.fill();}
        update(){
            if(this.x>canvas.width||this.x<0)this.directionX=-this.directionX;
            if(this.y>canvas.height||this.y<0)this.directionY=-this.directionY;
            let dx=mouse.x-this.x;let dy=mouse.y-this.y;let distance=Math.sqrt(dx*dx+dy*dy);
            if(distance<mouse.radius+this.size){
                if(mouse.x<this.x&&this.x<canvas.width-this.size*10)this.x+=10;
                if(mouse.x>this.x&&this.x>this.size*10)this.x-=10;
                if(mouse.y<this.y&&this.y<canvas.height-this.size*10)this.y+=10;
                if(mouse.y>this.y&&this.y>this.size*10)this.y-=10;
            }
            this.x+=this.directionX;this.y+=this.directionY;this.draw();
        }
    }
    function initParticles(){
        particlesArray=[];let numberOfParticles=(canvas.height*canvas.width)/9000;
        for(let i=0;i<numberOfParticles;i++){
            let size=(Math.random()*2)+1;let x=(Math.random()*((innerWidth-size*2)-(size*2))+size*2);
            let y=(Math.random()*((innerHeight-size*2)-(size*2))+size*2);let dx=(Math.random()*2)-1;let dy=(Math.random()*2)-1;
            particlesArray.push(new Particle(x,y,dx,dy,size,'#00f3ff'));
        }
    }
    function animateParticles(){requestAnimationFrame(animateParticles);ctx.clearRect(0,0,innerWidth,innerHeight);for(let i=0;i<particlesArray.length;i++){particlesArray[i].update();}connectParticles();}
    function connectParticles(){
        let opacityValue=1;for(let a=0;a<particlesArray.length;a++){for(let b=a;b<particlesArray.length;b++){
            let distance=((particlesArray[a].x-particlesArray[b].x)*(particlesArray[a].x-particlesArray[b].x))+((particlesArray[a].y-particlesArray[b].y)*(particlesArray[a].y-particlesArray[b].y));
            if(distance<(canvas.width/7)*(canvas.height/7)){opacityValue=1-(distance/20000);ctx.strokeStyle='rgba(188,19,254,'+opacityValue+')';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(particlesArray[a].x,particlesArray[a].y);ctx.lineTo(particlesArray[b].x,particlesArray[b].y);ctx.stroke();}
        }}
    }
    window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;mouse.radius=(canvas.height/80)*(canvas.width/80);initParticles();});
    initParticles();animateParticles();
    // 3Dãƒãƒ«ãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨
    document.querySelectorAll('.tilt-effect').forEach(card => {
        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left; const y = e.clientY - rect.top;
            const centerX = rect.width / 2; const centerY = rect.height / 2;
            const rotateX = ((y - centerY) / centerY) * -3; const rotateY = ((x - centerX) / centerX) * 3;
            card.style.transform = `perspective(2000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        });
        card.addEventListener('mouseleave', () => { card.style.transform = `perspective(2000px) rotateX(0deg) rotateY(0deg)`; });
    });

    // ==========================================
    // å…ƒã®ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—)
    // ==========================================
    const AUTH_GAS_URL    = "https://script.google.com/macros/s/AKfycbzzdPk8BxStCsLa0iyhkHeLp3AGnbcvn5FtMrFjRSIvO2aNXQZMdvlsdC44Mrmn6MZ7/exec";
    const BBS_GAS_URL     = "https://script.google.com/macros/s/AKfycbzOpcoQtkoLBCUhmfd4RPCV6BhQs8ngf9fLiXYE8ALgDmJsr_ic4LnrSyFj5ChgwJoRhQ/exec";
    const NEWS_GAS_URL    = "https://script.google.com/macros/s/AKfycbzOm_RDGEyq_kPsbER9GT4vTwZD68X39dgrZ0-udH1CyTN9sQcjW3_MgRmAd29BwLjIsQ/exec";
    const THREAD_GAS_URL  = "https://script.google.com/macros/s/AKfycbzNRFg-clJykjin35_EbMBiTzcdN73mHkqEuDfIQFaj-1Bf9ZSbwGGxnn4kBV8l25OBmw/exec";
    const GALLERY_GAS_URL = "https://script.google.com/macros/s/AKfycbwg-qyb79tkZq6u8K5NyHXt_7vivvqKgk5vt8lpzkjTM5rpd3G3Tx9jOLFs12i2Wqqp/exec";
    const ADMIN_SEC_URL   = "https://script.google.com/macros/s/AKfycbx5RTv_Lf_Fzs5L7c5Jly9z9KhkeLvjBAGScOK6Algg3hwiDOEL41Xi-en_YR_MryXOyA/exec"; 
    const TOKEN_GAS_URL   = "https://script.google.com/macros/s/AKfycbzGt1f97bwGpUhfmwKfxrrhryT9g76myvC0x4jwfxGYjJM3b2aGnTjs2aA5QxOOepo/exec"; 
    let currentAdminPass = "";

    async function adminAuth() {
        const pass = document.getElementById("adminInput").value;
        const res = await fetch(AUTH_GAS_URL, { method: "POST", body: JSON.stringify({ action: "admin_login", password: pass }) });
        const result = await res.json();
        if (result.success) {
            currentAdminPass = pass;
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("adminContent").style.display = "block";
            loadAllData();
        } else { alert("AUTHENTICATION FAILED"); }
    }

    async function generateToken() {
        const days = document.getElementById("tokenDays").value;
        if (!days || days <= 0) return alert("INVALID DAYS");
        if (!confirm(`GENERATE TOKEN FOR ${days} DAYS?`)) return;
        try {
            const res = await fetch(TOKEN_GAS_URL, { method: "POST", body: JSON.stringify({ action: "generate_token", days: days, adminPass: currentAdminPass }) });
            const result = await res.json();
            if (result.success) {
                document.getElementById("newTokenDisplay").style.display = "block";
                document.getElementById("generatedToken").innerText = result.token;
                document.getElementById("tokenInfo").innerText = `${days} DAYS VALID.`;
                loadTokenList();
            } else { alert("FAILED: " + result.msg); }
        } catch (e) { alert("NETWORK ERROR"); }
    }

    async function loadTokenList() {
        const list = document.getElementById("tokenList");
        try {
            const res = await fetch(`${TOKEN_GAS_URL}?action=get_tokens`);
            const tokens = await res.json();
            list.innerHTML = tokens.map(t => `<tr><td><span class="token-code">${t.code}</span></td><td>${t.days}</td><td style="color:${t.used == 1 ? '#888' : '#00f3ff'}">${t.used == 1 ? "USED" : "ACTIVE"}</td><td><small>${t.date}</small></td></tr>`).join("");
        } catch (e) { list.innerHTML = "<tr><td colspan='4'>LOAD FAILED</td></tr>"; }
    }

    async function loadSecurityData() {
        try {
            const res = await fetch(`${ADMIN_SEC_URL}?action=get_security_data`);
            const data = await res.json();
            document.getElementById("ngList").innerText = "CURRENT: " + data.ngWords.join(", ");
            document.getElementById("banList").innerText = "CURRENT: " + data.bannedUsers.join(", ");
            document.getElementById("logViewer").innerHTML = data.logs.map(l => `<span style="color:#888">[${l[0]}]</span> <span style="color:var(--secondary)">${l[1]}</span>: ${l[2]}`).join("<br>");
        } catch(e) { console.log("Security data load failed"); }
    }

    async function updateSecurity(action) {
        let payload = { adminPass: currentAdminPass, action: action };
        if(action === 'add_ng_word') payload.word = document.getElementById("ngInput").value;
        else payload.userName = document.getElementById("banInput").value;
        const res = await fetch(ADMIN_SEC_URL, { method: "POST", body: JSON.stringify(payload) });
        if((await res.json()).success) { alert("UPDATED"); loadSecurityData(); }
    }

    async function loadAllData() {
        loadSecurityData(); loadTokenList();
        fetch(AUTH_GAS_URL, { method: "POST", body: JSON.stringify({ action: "admin_get_users", adminPass: currentAdminPass }) }).then(r=>r.json()).then(d=>renderTable("userListBody", d.users, u=>`<td><span style="font-family:monospace">${u.id}</span></td><td>${u.name}</td><td><button class="del-btn" onclick="deleteItem('${AUTH_GAS_URL}','admin_delete_user','targetId','${u.id}')">DELETE</button></td>`));
        fetch(BBS_GAS_URL).then(r=>r.json()).then(d=>renderTable("postListBody", d, p=>`<td><small>${p.date}</small></td><td>${p.name}</td><td>${p.message.substring(0,20)}...</td><td><small>${p.ip||'---'}</small></td><td><small>${p.uid||'---'}</small></td><td><button class="del-btn" onclick="deleteItem('${BBS_GAS_URL}','admin_delete_post','row',${p.row})">DEL</button></td>`));
        fetch(NEWS_GAS_URL).then(r=>r.json()).then(d=>renderTable("newsListBody", d, n=>`<td>${n.date}</td><td>${n.title}</td><td><button class="del-btn" onclick="deleteItem('${NEWS_GAS_URL}','admin_delete_news','row',${n.row})">DEL</button></td>`));
        const threadRes = await fetch(THREAD_GAS_URL); const threads = await threadRes.json();
        renderTable("threadListBody", threads, t => `<td>${t.threadName}</td><td>${t.creator}</td><td><button class="del-btn" onclick="deleteItem('${THREAD_GAS_URL}','admin_delete_thread','threadName','${t.threadName}')">DELETE THREAD</button></td>`);
        const selector = document.getElementById("threadSelector"); selector.innerHTML = '<option value="">SELECT THREAD</option>';
        threads.forEach(t => selector.innerHTML += `<option value="${t.threadName}">${t.threadName}</option>`);
        fetch(GALLERY_GAS_URL).then(r=>r.json()).then(d=>renderTable("galleryListBody", d, g=>`<td>${g.name}</td><td>${g.message.substring(0,15)}...</td><td>${g.imageUrl ? `<a href="${g.imageUrl}" target="_blank" style="color:var(--primary)">VIEW</a>` : "NONE"}</td><td><button class="del-btn" onclick="deleteItem('${GALLERY_GAS_URL}','admin_delete_post','row',${g.row})">DEL</button></td>`));
    }

    async function postNews() {
        const title = document.getElementById("newsTitleInput").value; const content = document.getElementById("newsContentInput").value;
        if (!title || !content) return alert("INPUT MISSING");
        const res = await fetch(NEWS_GAS_URL, { method: "POST", body: JSON.stringify({ action: "post_news", title: title, content: content, adminPass: currentAdminPass }) });
        if ((await res.json()).success) { alert("NEWS POSTED"); document.getElementById("newsTitleInput").value = ""; document.getElementById("newsContentInput").value = ""; loadAllData(); }
    }

    async function loadThreadPosts() {
        const threadId = document.getElementById("threadSelector").value; if(!threadId) return;
        const res = await fetch(`${THREAD_GAS_URL}?thread=${encodeURIComponent(threadId)}`);
        const posts = await res.json();
        renderTable("threadPostListBody", posts, p => `<td>${p.name}</td><td>${p.message.substring(0,30)}...</td><td><button class="del-btn" onclick="deleteThreadPost('${threadId}', ${p.row})">DEL</button></td>`);
    }

    async function deleteThreadPost(threadId, row) {
        if(!confirm("DELETE POST?")) return;
        const res = await fetch(THREAD_GAS_URL, { method: "POST", body: JSON.stringify({ action: "admin_delete_thread_post", threadId: threadId, row: row, adminPass: currentAdminPass }) });
        if((await res.json()).success) loadThreadPosts();
    }

    function renderTable(id, data, htmlFunc) {
        const b = document.getElementById(id); b.innerHTML = "";
        if(data && Array.isArray(data)) data.forEach(item => { const r = document.createElement("tr"); r.innerHTML = htmlFunc(item); b.appendChild(r); });
    }

    async function deleteItem(url, action, keyName, val) {
        if(!confirm("DELETE ITEM?")) return;
        const body = { action: action, adminPass: currentAdminPass }; body[keyName] = val;
        const res = await fetch(url, { method: "POST", body: JSON.stringify(body) });
        if((await res.json()).success) loadAllData();
    }
</script>
</body>
</html>
