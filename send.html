<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒªãƒ¢ãƒ¼ãƒˆãƒ»ãƒ—ãƒ­ã‚»ã‚¹ã‚­ãƒ©ãƒ¼</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1e1e1e; color: white; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 8px; width: 350px; }
        button { width: 100%; padding: 15px; background: #d32f2f; color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        button:hover { background: #b71c1c; }
        button:disabled { background: #555; }
        #response { margin-top: 15px; color: #4caf50; font-weight: bold; min-height: 20px;}
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ¯ ãƒªãƒ¢ãƒ¼ãƒˆç®¡ç†ãƒ‘ãƒãƒ«</h2>
    <p>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰PCã®Edgeãƒ–ãƒ©ã‚¦ã‚¶ã‚’å¼·åˆ¶çµ‚äº†ã•ã›ã¾ã™ã€‚</p>
    
    <button id="kill-btn">Edgeã‚’å¼·åˆ¶çµ‚äº† (KILL)</button>

    <div id="response"></div>
</div>

<script type="py">
import json
from pyodide.ffi import create_proxy
from pyodide.http import pyfetch
from js import document

async def send_kill_command(event):
    btn = document.getElementById("kill-btn")
    res_div = document.getElementById("response")
    
    btn.disabled = True
    res_div.innerText = "å®Ÿè¡Œä¸­..."
    res_div.style.color = "#ffeb3b"

    # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€ã‚‹æŒ‡ä»¤
    payload = {"instruction": "kill_edge"}

    try:
        # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒåˆ¥PCã®å ´åˆã¯ã€localhostã‚’ãã®PCã®ãƒ­ãƒ¼ã‚«ãƒ«IPï¼ˆä¾‹: 192.168.1.5ï¼‰ã«å¤‰æ›´ã—ã¦ãã ã•ã„
        response = await pyfetch(
            "http://localhost:8000/api/command",
            method="POST",
            headers={"Content-Type": "application/json"},
            body=json.dumps(payload)
        )

        if response.ok:
            data = await response.json()
            res_div.innerText = data["message"]
            res_div.style.color = "#4caf50"
        else:
            res_div.innerText = f"é€šä¿¡ã‚¨ãƒ©ãƒ¼: {response.status}"
            res_div.style.color = "#f44336"
            
    except Exception as e:
        res_div.innerText = "ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚"
        res_div.style.color = "#f44336"
        print(e)
        
    finally:
        btn.disabled = False

document.getElementById("kill-btn").addEventListener("click", create_proxy(send_kill_command))
</script>

</body>
</html>
