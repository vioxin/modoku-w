<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒªãƒ¢ãƒ¼ãƒˆãƒ»ãƒ—ãƒ­ã‚»ã‚¹ã‚­ãƒ©ãƒ¼</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1e1e1e; color: white; display: flex; justify-content: center;}
        .card { background: #2d2d2d; padding: 25px; border-radius: 8px; width: 400px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-size: 0.9em; color: #aaa; }
        input[type="text"] { width: 100%; padding: 10px; background: #121212; border: 1px solid #444; color: #00ff00; font-family: monospace; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #d32f2f; color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 5px; transition: background 0.2s; }
        button:hover { background: #b71c1c; }
        button:disabled { background: #555; cursor: not-allowed; }
        #response { margin-top: 15px; color: #4caf50; font-weight: bold; min-height: 40px; word-break: break-all; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ¯ ãƒªãƒ¢ãƒ¼ãƒˆç®¡ç†ãƒ‘ãƒãƒ«</h2>
    <p>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰PCã®Edgeãƒ–ãƒ©ã‚¦ã‚¶ã‚’å¼·åˆ¶çµ‚äº†ã•ã›ã¾ã™ã€‚</p>
    
    <div class="input-group">
        <label for="url-input">æ¥ç¶šå…ˆURL (ngrok ã¾ãŸã¯ localhost)</label>
        <input type="text" id="url-input" value="http://localhost:8000/api/command" placeholder="https://xxxx.ngrok-free.app">
    </div>

    <button id="kill-btn">Edgeã‚’å¼·åˆ¶çµ‚äº† (KILL)</button>

    <div id="response">æº–å‚™å®Œäº†ã€‚</div>
</div>

<script type="py">
import json
from pyodide.ffi import create_proxy
from pyodide.http import pyfetch
from js import document

async def send_kill_command(event):
    btn = document.getElementById("kill-btn")
    res_div = document.getElementById("response")
    url_input = document.getElementById("url-input").value.strip()
    
    # URLãŒç©ºã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼
    if not url_input:
        res_div.innerText = "ã‚¨ãƒ©ãƒ¼: URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
        res_div.style.color = "#f44336"
        return

    # ã€è¦ªåˆ‡æ©Ÿèƒ½ã€‘æœ«å°¾ã« /api/command ãŒç„¡ã‘ã‚Œã°è‡ªå‹•ã§ä»˜ã‘ã‚‹
    if not url_input.endswith("/api/command"):
        if url_input.endswith("/"):
            url_input += "api/command"
        else:
            url_input += "/api/command"
        
        # UIã®è¡¨ç¤ºã‚‚æ›¸ãæ›ãˆã¦ã‚ã’ã‚‹
        document.getElementById("url-input").value = url_input

    btn.disabled = True
    res_div.innerText = f"é€ä¿¡ä¸­...\nå®›å…ˆ: {url_input}"
    res_div.style.color = "#ffeb3b"

    payload = {"instruction": "kill_edge"}

    try:
        response = await pyfetch(
            url_input,
            method="POST",
            headers={"Content-Type": "application/json"},
            body=json.dumps(payload)
        )

        if response.ok:
            data = await response.json()
            res_div.innerText = data["message"]
            res_div.style.color = "#4caf50"
        else:
            res_div.innerText = f"é€šä¿¡ã‚¨ãƒ©ãƒ¼: {response.status}\nURLãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€ã‚µãƒ¼ãƒãƒ¼ãŒå‹•ã„ã¦ã„ã¾ã›ã‚“ã€‚"
            res_div.style.color = "#f44336"
            
    except Exception as e:
        res_div.innerText = f"æ¥ç¶šã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼ã«åˆ°é”ã§ãã¾ã›ã‚“ã€‚\n(ngrokã®URLã‚„èµ·å‹•çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„)"
        res_div.style.color = "#f44336"
        print(e)
        
    finally:
        btn.disabled = False

document.getElementById("kill-btn").addEventListener("click", create_proxy(send_kill_command))
</script>

</body>
</html>
