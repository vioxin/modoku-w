<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NEON SURVIVOR GAME</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Zen+Kaku+Gothic+New:wght@900&display=swap');

    :root {
        --bg-color: #050510;
        --neon-blue: #00f3ff;
        --neon-red: #ff0055;
        --neon-green: #0aff0a;
    }

    body {
        margin: 0; padding: 0;
        background-color: var(--bg-color);
        color: white;
        overflow: hidden; /* スクロール禁止 */
        font-family: 'Press Start 2P', cursive; /* ゲームっぽいフォント */
        touch-action: none; /* スマホでのズーム等を禁止 */
        user-select: none;
    }

    /* === ゲーム画面 (Canvas) === */
    #gameCanvas {
        display: block;
        margin: 0 auto;
        background: linear-gradient(to bottom, #000022, #000000);
        box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
    }

    /* === UIレイヤー (HTMLで表示・安全策) === */
    #ui-layer {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; /* ゲーム操作を邪魔しない */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
    }

    .score-board {
        font-size: 1.5rem;
        color: var(--neon-blue);
        text-shadow: 2px 2px 0 #000;
    }

    /* === スタート/ゲームオーバー画面 === */
    #menu-screen {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        pointer-events: auto;
        backdrop-filter: blur(5px);
    }

    h1 {
        font-size: 2.5rem;
        color: var(--neon-blue);
        text-shadow: 0 0 10px var(--neon-blue);
        margin-bottom: 20px;
        text-align: center;
        line-height: 1.5;
    }

    .start-btn {
        padding: 20px 40px;
        font-size: 1.2rem;
        background: var(--neon-red);
        color: white;
        border: none;
        box-shadow: 0 0 15px var(--neon-red);
        cursor: pointer;
        animation: pulse 1s infinite alternate;
        font-family: 'Press Start 2P', cursive;
        margin-top: 20px;
    }

    @keyframes pulse { from{transform:scale(1);} to{transform:scale(1.05);} }

    /* === スマホ用コントローラー === */
    .mobile-controls {
        position: absolute;
        bottom: 0; left: 0;
        width: 100%; height: 50%; /* 画面の下半分すべてがボタン */
        display: flex;
        z-index: 50;
    }
    .control-btn {
        flex: 1;
        /* border: 1px solid rgba(255,255,255,0.1); */ /* デバッグ用 */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 3rem;
        color: rgba(255,255,255,0.1);
        cursor: pointer;
    }
    .control-btn:active {
        background: rgba(0, 243, 255, 0.1);
    }

</style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="score-board">SCORE: <span id="scoreVal">0</span></div>
        <div class="score-board" style="font-size:0.8rem; text-align:right;">HIGH: <span id="highScoreVal">0</span></div>
    </div>

    <div id="menu-screen">
        <h1 id="titleText">NEON<br>SURVIVOR</h1>
        <p style="color:#aaa; text-align:center; line-height:1.6; font-size:0.8rem;">
            [PC] Arrow Keys<br>
            [MOBILE] Tap Left/Right<br>
            <span style="color:var(--neon-green)">GREEN = GOOD (+100)</span><br>
            <span style="color:var(--neon-red)">RED = BAD (GAME OVER)</span>
        </p>
        <button class="start-btn" onclick="startGame()">START GAME</button>
    </div>

    <div class="mobile-controls">
        <div class="control-btn" id="btnLeft">←</div>
        <div class="control-btn" id="btnRight">→</div>
    </div>

<script>
    // --- ゲーム設定 ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('scoreVal');
    const highScoreEl = document.getElementById('highScoreVal');
    const menu = document.getElementById('menu-screen');
    const title = document.getElementById('titleText');

    // 画面サイズ調整
    let width, height;
    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- ゲーム変数 ---
    let isPlaying = false;
    let score = 0;
    let highScore = 0;
    let frame = 0;
    let speedMultiplier = 1;

    // プレイヤー
    const player = {
        x: width / 2,
        y: height - 100,
        size: 20,
        speed: 7,
        color: '#00f3ff'
    };

    // オブジェクト管理
    let enemies = [];
    let items = [];
    let particles = [];

    // --- 入力管理 ---
    const keys = { ArrowLeft: false, ArrowRight: false };

    // PCキーボード
    window.addEventListener('keydown', e => { if(keys.hasOwnProperty(e.code)) keys[e.code] = true; });
    window.addEventListener('keyup', e => { if(keys.hasOwnProperty(e.code)) keys[e.code] = false; });
    // PC左右キー対応（矢印キー以外も対応する場合）
    window.addEventListener('keydown', e => { 
        if(e.key === "ArrowLeft") keys.ArrowLeft = true;
        if(e.key === "ArrowRight") keys.ArrowRight = true;
    });
    window.addEventListener('keyup', e => { 
        if(e.key === "ArrowLeft") keys.ArrowLeft = false;
        if(e.key === "ArrowRight") keys.ArrowRight = false;
    });

    // スマホタッチ
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');
    
    const handleTouchStart = (dir) => { keys[dir] = true; };
    const handleTouchEnd = (dir) => { keys[dir] = false; };

    // マウス/タッチ両対応
    btnLeft.addEventListener('mousedown', () => keys.ArrowLeft = true);
    btnLeft.addEventListener('mouseup', () => keys.ArrowLeft = false);
    btnLeft.addEventListener('touchstart', (e) => { e.preventDefault(); keys.ArrowLeft = true; });
    btnLeft.addEventListener('touchend', (e) => { e.preventDefault(); keys.ArrowLeft = false; });

    btnRight.addEventListener('mousedown', () => keys.ArrowRight = true);
    btnRight.addEventListener('mouseup', () => keys.ArrowRight = false);
    btnRight.addEventListener('touchstart', (e) => { e.preventDefault(); keys.ArrowRight = true; });
    btnRight.addEventListener('touchend', (e) => { e.preventDefault(); keys.ArrowRight = false; });


    // --- ゲームループ ---
    function startGame() {
        menu.style.display = 'none';
        isPlaying = true;
        score = 0;
        speedMultiplier = 1;
        enemies = [];
        items = [];
        particles = [];
        player.x = width / 2;
        scoreEl.innerText = score;
        loop();
    }

    function gameOver() {
        isPlaying = false;
        menu.style.display = 'flex';
        title.innerHTML = "GAME OVER<br><span style='font-size:1.5rem; color:#fff'>SCORE: " + score + "</span>";
        document.querySelector('.start-btn').innerText = "RETRY";
        
        // 画面シェイクエフェクト
        document.body.style.transform = "translate(5px, 5px)";
        setTimeout(() => document.body.style.transform = "none", 100);

        if(score > highScore) {
            highScore = score;
            highScoreEl.innerText = highScore;
        }
    }

    function loop() {
        if(!isPlaying) return;

        // 背景クリア
        ctx.fillStyle = 'rgba(5, 0, 16, 0.3)'; // 残像効果
        ctx.fillRect(0, 0, width, height);

        // 背景グリッド描画（流れる演出）
        drawGrid();

        // プレイヤー移動
        if(keys.ArrowLeft && player.x > player.size) player.x -= player.speed;
        if(keys.ArrowRight && player.x < width - player.size) player.x += player.speed;

        // プレイヤー描画
        drawPlayer();

        // 敵（障害物）の生成と移動
        handleEnemies();
        
        // アイテムの生成と移動
        handleItems();

        // パーティクル（エフェクト）
        handleParticles();

        // スコア加算（生存ボーナス）
        if(frame % 60 === 0) {
            score += 10;
            scoreEl.innerText = score;
            speedMultiplier += 0.01; // 徐々に速くなる
        }

        frame++;
        requestAnimationFrame(loop);
    }

    // --- 描画・ロジック関数 ---

    function drawGrid() {
        ctx.strokeStyle = 'rgba(0, 243, 255, 0.1)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        // 縦線
        for(let x=0; x<width; x+=50) {
            ctx.moveTo(x, 0);
            ctx.lineTo(x, height);
        }
        // 横線（動く）
        const offset = (frame * 2) % 50;
        for(let y=offset; y<height; y+=50) {
            ctx.moveTo(0, y);
            ctx.lineTo(width, y);
        }
        ctx.stroke();
    }

    function drawPlayer() {
        ctx.fillStyle = player.color;
        ctx.shadowBlur = 20;
        ctx.shadowColor = player.color;
        
        // 三角形を描画
        ctx.beginPath();
        ctx.moveTo(player.x, player.y - player.size); // Top
        ctx.lineTo(player.x - player.size, player.y + player.size); // Left Bottom
        ctx.lineTo(player.x + player.size, player.y + player.size); // Right Bottom
        ctx.closePath();
        ctx.fill();

        ctx.shadowBlur = 0; // リセット
    }

    function handleEnemies() {
        // 生成
        if(Math.random() < 0.03 * speedMultiplier) {
            const size = Math.random() * 30 + 20;
            enemies.push({
                x: Math.random() * (width - size),
                y: -50,
                size: size,
                speed: (Math.random() * 3 + 3) * speedMultiplier,
                color: '#ff0055'
            });
        }

        // 移動と描画
        for(let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i];
            e.y += e.speed;

            // 描画（四角形・グリッチ風）
            ctx.fillStyle = e.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = e.color;
            ctx.fillRect(e.x, e.y, e.size, e.size);
            ctx.shadowBlur = 0;

            // 当たり判定
            if(
                player.x < e.x + e.size &&
                player.x + player.size > e.x &&
                player.y < e.y + e.size &&
                player.y + player.size > e.y
            ) {
                createExplosion(player.x, player.y, player.color);
                gameOver();
            }

            // 画面外削除
            if(e.y > height) enemies.splice(i, 1);
        }
    }

    function handleItems() {
        // 生成（敵より頻度低い）
        if(Math.random() < 0.01) {
            const size = 15;
            items.push({
                x: Math.random() * (width - size),
                y: -50,
                size: size,
                speed: 4,
                color: '#0aff0a'
            });
        }

        for(let i = items.length - 1; i >= 0; i--) {
            let item = items[i];
            item.y += item.speed;

            // 丸を描画
            ctx.beginPath();
            ctx.arc(item.x, item.y, item.size, 0, Math.PI*2);
            ctx.fillStyle = item.color;
            ctx.shadowBlur = 15;
            ctx.shadowColor = item.color;
            ctx.fill();
            ctx.shadowBlur = 0;

            // 当たり判定（取得）
            const dist = Math.hypot(player.x - item.x, player.y - item.y);
            if(dist < player.size + item.size) {
                score += 100;
                scoreEl.innerText = score;
                // 取得エフェクト
                createExplosion(item.x, item.y, item.color);
                // 一瞬光らせる
                document.body.style.backgroundColor = "#002200";
                setTimeout(()=> document.body.style.backgroundColor = "var(--bg-color)", 50);
                
                items.splice(i, 1);
            }

            if(item.y > height) items.splice(i, 1);
        }
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<15; i++) {
            particles.push({
                x: x, y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                life: 1.0,
                color: color
            });
        }
    }

    function handleParticles() {
        for(let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.05;

            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 4, 4);
            ctx.globalAlpha = 1.0;

            if(p.life <= 0) particles.splice(i, 1);
        }
    }

</script>
</body>
</html>
